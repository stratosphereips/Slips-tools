# Slips Evidence Log DAG Generator

This directory contains tools for generating textual DAGs (Directed Acyclic Graphs) from Slips network security evidence logs.

## Directory Structure

```
slips-tools/finetune/rawdata/
├── README_slips_dag.md                 # Main documentation
├── slips_dag_generator.py              # Main tool script
├── sample_logs/                        # Sample log files for testing
│   ├── slips-1.log
│   ├── slips-5.log
│   ├── slips-evidence.log
│   ├── slips-normal.log
│   ├── slips-normal-2.log
│   ├── slips-normal-3.log
│   ├── slips.log
│   └── test_data.log
├── examples/                           # Example outputs and demos
│   ├── sample_dag_output.txt
│   └── output.txt
└── tests/                              # Future test files
```

## Files

- **`slips_dag_generator.py`** - Python script that automatically parses Slips logs and generates textual DAGs
- **`sample_logs/`** - Directory containing sample Slips evidence log files for testing
- **`examples/`** - Directory containing example outputs generated by the DAG generator

## Python Script Usage

### Basic Usage

```bash
# Generate compact DAG for single IP (default format)
python3 slips_dag_generator.py sample_logs/test_data.log 192.168.1.113

# Process ALL IP addresses in log file automatically
python3 slips_dag_generator.py sample_logs/test_data.log --all-ips

# All IPs with minimal summary format
python3 slips_dag_generator.py sample_logs/test_data.log --all-ips --minimal

# All IPs with attack pattern analysis
python3 slips_dag_generator.py sample_logs/test_data.log --all-ips --pattern

# Filter all IPs by threat level
python3 slips_dag_generator.py sample_logs/test_data.log --all-ips --min-threat high

# Export all IPs as structured JSON
python3 slips_dag_generator.py sample_logs/test_data.log --all-ips --json

# Single IP with specific options
python3 slips_dag_generator.py sample_logs/test_data.log 192.168.1.113 --full --summary
```

### Command Line Options

**Required Arguments:**
- `log_file` - Path to the Slips evidence log file
- `target_ip` - IP address to analyze (optional when using `--all-ips`)

**Multi-IP Processing:**
- `--all-ips`, `-a` - Automatically discover and process ALL IP addresses in the log file

**Output Format Options (mutually exclusive):**
- `--compact`, `-c` - Compact single-line format (default)
- `--minimal`, `-m` - Minimal bullet-point summary  
- `--pattern`, `-p` - Attack pattern analysis format
- `--full`, `-f` - Full verbose format (original)

**Filtering Options:**
- `--min-threat LEVEL` - Filter by minimum threat level (info, low, medium, high, critical)
- `--max-events N` - Limit to N most significant events
- `--group-time MINUTES` - Group events within N-minute windows

**Output Options:**
- `--output`, `-o` - Output file path (default: stdout)
- `--summary`, `-s` - Include summary statistics (not with minimal format)
- `--json`, `-j` - Output raw events as JSON instead of DAG
- `--verbose`, `-v` - Enable verbose logging
- `--help`, `-h` - Show help message

### Example Output Formats

**Compact Format (default):**
```
192.168.1.113
├─ 23:27:45 → Scan: 443. (1t, 5p) [HIG/0.5]
├─ 23:27:49 → C&C: 88.11.164.60 (s:0.9910.) [HIG/0.03]
├─ 23:27:54 → Blacklist: 92.12.70.54 (OPALTELECOM-AS) [MED/1.0]
└─ 23:47:14 → No-DNS: 195.113.232.73 [HIG/0.8]
```

**Minimal Format:**
```
192.168.1.113 Attack Summary:
• 23:27 - Port scans: 443., 80. (max: 2 hosts) [HIGH]
• 23:27 - C&C channels: 1 connections [HIGH]
• 23:27 - DNS evasion: 1 connections [HIGH]
• Duration: 0.3 hours, 7 events
• Risk: CRITICAL - Sustained malicious activity
```

**Pattern Analysis Format:**
```
192.168.1.113 - Attack Pattern Analysis
Phase 1 (23:00-23:59): Reconnaissance
• Port scanning: 443., 80. → 2+ targets
• Network discovery: 5 additional probes
```

**Comparison: 7 events in different formats**
- **Compact**: 6 lines (83% reduction)
- **Minimal**: 5 lines (86% reduction) 
- **Pattern**: 4 lines (89% reduction)
- **Full**: 24 lines (original verbose format)

## Features

### Supported Evidence Types

The script automatically classifies and extracts the following types of security evidence:

1. **Port Scans** - Horizontal and vertical port scanning activities
2. **C&C Channels** - Command and control server connections
3. **Blacklisted IPs** - Connections to known malicious IP addresses
4. **Suspicious Connections** - Non-HTTP/SSL connections to unexpected ports
5. **Private IP Connections** - Connections to private/internal IP addresses
6. **DNS Issues** - Connections without proper DNS resolution
7. **Unencrypted Traffic** - HTTP traffic that should be encrypted
8. **Malicious Detections** - IPs detected as malicious by Slips

### Output Formats

1. **Textual DAG** - Hierarchical tree structure showing chronological events
2. **JSON Export** - Structured data export for further processing
3. **Summary Statistics** - Event type counts and threat level distribution

### Key Benefits

- **Chronological Timeline** - Events ordered by timestamp for incident analysis
- **Threat Context** - Includes threat levels and confidence scores
- **Rich Details** - AS information, port numbers, packet counts where available
- **Incident Response Ready** - Formatted for security analyst workflows
- **Automated Processing** - No manual log parsing required

## Example Use Cases

### 1. Incident Response - Complete Network View

Get instant overview of ALL suspicious IPs in your network:

```bash
python3 slips_dag_generator.py sample_logs/slips-evidence.log --all-ips --minimal
```

### 2. Threat Hunting - Single IP Analysis

Deep dive into specific IP behavior:

```bash
python3 slips_dag_generator.py sample_logs/slips-normal.log 10.0.2.15 --full --summary
```

### 3. Report Generation - Multi-IP JSON Export

Export all network threats as structured data:

```bash
python3 slips_dag_generator.py sample_logs/slips-5.log --all-ips --json --output examples/network_threats.json
```

### 4. Forensic Analysis - High-Priority Events Only

Focus on critical security events across all IPs:

```bash
python3 slips_dag_generator.py sample_logs/slips-normal.log --all-ips --min-threat high --max-events 20
```

### 5. Quick Network Security Assessment

Get immediate visual summary of attack patterns:

```bash
python3 slips_dag_generator.py sample_logs/test_data.log --all-ips --pattern
```

## Technical Details

### Log Format Requirements

The script expects Slips evidence logs in the standard format with:
- Timestamp in `YYYY/MM/DD HH:MM:SS.microseconds` format
- `[Evidence]` markers for evidence lines
- Profile identifiers as `profile_X.X.X.X`
- Threat level and confidence information where available

### Event Classification

Events are classified using regex patterns that match specific Slips evidence formats. The script handles various log formats and extracts relevant security context automatically.

### Performance

- Processes large log files efficiently
- Memory usage scales with the number of events for target IP (not total log size)
- Suitable for real-time analysis of ongoing incidents

## Dependencies

- Python 3.6+
- Standard library only (no external dependencies required)

## Integration

The script can be easily integrated into:
- Security orchestration platforms (SOAR)
- Incident response workflows
- Automated threat hunting pipelines
- Security information and event management (SIEM) systems